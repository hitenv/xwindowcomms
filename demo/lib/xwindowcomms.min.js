/*! xwindowcomms - v0.0.4 - 2016-01-21
* Copyright (c) 2016 ; Licensed  */
window.xWindowComms=window.xWindowComms||function(){var a=function(){this.popup=null,this.handshake=null,this.connected=!1,this.buffer=[],this.id=Math.random(),this.initiate=function(a,b,c){this.popup=window.open(a,b,c);var d={action:"initiate",status:!1,type:"xWindowComms"};this.handshake=setInterval(function(){this.sendMessage(d)}.bind(this),1e3)},this.sendMessage=function(a){a.id=this.id,a.type="xWindowComms",this.connected||"initiate"===a.action?this.popup.postMessage(a,"*"):this.buffer.push(a)},this.receiver=function(a,b){var c=window.addEventListener?"addEventListener":"attachEvent",d=window[c],e="attachEvent"===c?"onmessage":"message";d(e,function(c){if(b===!0&&console.log(c),"object"==typeof c.data&&"xWindowComms"===c.data.type&&c.data.id===this.id){if("initiate"===c.data.action&&c.data.status===!0&&(clearInterval(this.handshake),this.connected=!0,this.buffer.length>0)){for(var d=0;d<this.buffer.length;d++)this.sendMessage(this.buffer[d]);this.buffer=[]}a(c)}}.bind(this))}},b=function(){this.parent=null,this.id=null,this.connected=!1,this.buffer=[],this.initiate=function(a,b){var c=window.addEventListener?"addEventListener":"attachEvent",d=window[c],e="attachEvent"===c?"onmessage":"message",f=function(c){if(b===!0&&console.log(c),"object"==typeof c.data&&"xWindowComms"===c.data.type){if("initiate"===c.data.action){var d={action:"initiate",status:!0};if(this.connected=!0,this.id=c.data.id,this.parent=c.source,this.sendMessage(d),this.buffer.length>0){for(var e=0;e<this.buffer.length;e++)this.sendMessage(this.buffer[e]);this.buffer=[]}}a(c)}}.bind(this);d(e,f)},this.sendMessage=function(a){a.id=this.id,a.type="xWindowComms",this.connected||"initiate"===a.action?this.parent.postMessage(a,"*"):this.buffer.push(a)}},c={parent:a,popup:b};return c}();