/*! xwindowcomms - v0.0.2 - 2015-11-27
* Copyright (c) 2015 ; Licensed  */
var xWindowComms=function(){var a={parent:{},popup:{}},b=Math.random();return a.parent.popup=null,a.handshake=null,a.parent.connected=!1,a.buffer=[],a.parent.initiate=function(b,c,d){a.parent.popup=window.open(b,c,d);var e={action:"initiate",status:!1};a.handshake=setInterval(function(){a.parent.sendMessage(e)},1e3)},a.parent.sendMessage=function(c){c.id=b,a.parent.connected||"initiate"===c.action?a.parent.popup.postMessage(c,"*"):a.buffer.push(c)},a.parent.receiver=function(c,d){var e=window.addEventListener?"addEventListener":"attachEvent",f=window[e],g="attachEvent"===e?"onmessage":"message";f(g,function(e){if(d===!0&&console.log(e),"object"==typeof event.data&&event.data.id===b){if("initiate"===event.data.action&&event.data.status===!0&&(clearInterval(a.handshake),a.parent.connected=!0,a.buffer.length>0)){for(var f=0;f<a.buffer.length;f++)a.parent.sendMessage(a.buffer[f]);a.buffer=[]}c(e)}})},a.popup.parent=null,a.popup.id=null,a.popup.initiate=function(b,c){var d=window.addEventListener?"addEventListener":"attachEvent",e=window[d],f="attachEvent"===d?"onmessage":"message";e(f,function(d){if(c===!0&&console.log(d),"object"==typeof event.data&&"initiate"===event.data.action){var e={action:"initiate",status:!0};a.popup.id=event.data.id,a.popup.parent=event.source,a.popup.sendMessage(e)}b(d)})},a.popup.sendMessage=function(b){b.id=a.popup.id,a.popup.parent.postMessage(b,"*")},a};