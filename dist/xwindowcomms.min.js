/*! xwindowcomms - v0.0.2 - 2015-11-30
* Copyright (c) 2015 ; Licensed  */
window.xWindowComms=window.xWindowComms||function(){var a=function(){this.popup=null,this.handshake=null,this.connected=!1,this.buffer=[],this.id=Math.random(),this.initiate=function(a,b,c){this.popup=window.open(a,b,c);var d={action:"initiate",status:!1};this.handshake=setInterval(function(){this.sendMessage(d)}.bind(this),1e3)},this.sendMessage=function(a){a.id=this.id,this.connected||"initiate"===a.action?this.popup.postMessage(a,"*"):this.buffer.push(a)},this.receiver=function(a,b){var c=window.addEventListener?"addEventListener":"attachEvent",d=window[c],e="attachEvent"===c?"onmessage":"message";d(e,function(c){if(b===!0&&console.log(c),"object"==typeof event.data&&event.data.id===this.id){if("initiate"===event.data.action&&event.data.status===!0&&(clearInterval(this.handshake),this.connected=!0,this.buffer.length>0)){for(var d=0;d<this.buffer.length;d++)this.sendMessage(this.buffer[d]);this.buffer=[]}a(c)}}.bind(this))}},b=function(){this.parent=null,this.id=null,this.initiate=function(a,b){var c=window.addEventListener?"addEventListener":"attachEvent",d=window[c],e="attachEvent"===c?"onmessage":"message";d(e,function(c){if(b===!0&&console.log(c),"object"==typeof event.data&&"initiate"===event.data.action){var d={action:"initiate",status:!0};this.id=event.data.id,this.parent=event.source,this.sendMessage(d)}a(c)}.bind(this))},this.sendMessage=function(a){a.id=this.id,this.parent.postMessage(a,"*")}},c={parent:a,popup:b};return c}();